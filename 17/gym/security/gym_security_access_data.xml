<?xml version="1.0"?>
<odoo>

    <!-- Parent and Sub Category for Gym Groups -->
    <record model="ir.module.category" id="my_parent_category">
        <field name="name">Gym Parent Category</field>
    </record>

    <record model="ir.module.category" id="my_sub_group_category">
        <field name="name">Gym Sub Category</field>
        <field name="parent_id" ref="my_parent_category"/>
    </record>

    <!-- Security groups -->

    <record id="group_gym_member" model="res.groups">
        <field name="name">Gym Member</field>
        <field name="category_id" ref="my_sub_group_category"/>
    </record>

    <record id="group_gym_trainer" model="res.groups">
        <field name="name">Gym Trainer</field>
        <field name="category_id" ref="my_sub_group_category"/>
        <field name="implied_ids" eval="[(6,0,[ref('group_gym_member')])]"/>
        <field name="comment">Group for gym trainers, managing members, workout plans, and attendance.</field>
    </record>

    <record id="group_gym_admin" model="res.groups">
        <field name="name">Gym Admin</field>
        <field name="category_id" ref="my_sub_group_category"/>
        <field name="implied_ids" eval="[(6,0,[ref('group_gym_trainer')])]"/>
        <field name="comment">Group for managing gym members, trainers, and full access to the gym module.</field>
    </record>

    <!-- Access Rights: Gym Member Model -->


    <record id="gym_member_access_admin" model="ir.model.access">
        <field name="name">gym.member.access.admin</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="group_id" ref="group_gym_admin"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <record id="gym_member_access_trainer" model="ir.model.access">
        <field name="name">gym.member.access.trainer</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="group_id" ref="group_gym_trainer"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="gym_member_access_member" model="ir.model.access">
        <field name="name">gym.member.access.member</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="group_id" ref="group_gym_member"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
        <field name="perm_write" eval="False"/>
    </record>


    <!-- Domain Rules for restricting access -->

    <!-- Rule for Trainers: Trainers can only access records related to their assigned members -->
    <record id="gym_member_rule_trainer" model="ir.rule">
        <field name="name">Gym Member Access for Trainers</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="groups"  eval="[Command.link(ref('group_gym_trainer'))]"/>
        <field name="domain_force">['|', ('id', '=', user.partner_id.id), ('id', 'in', user.partner_id.child_ids.ids)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Rule for Members: Members can only access records with their generated gymid (GMID) -->
    <record id="gym_member_rule_member" model="ir.rule">
        <field name="name">Gym Member Access for Members</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="groups" eval="[Command.link(ref('group_gym_member'))]"/>
        <field name="domain_force">['|','|',('gymid', '=like', 'GMID%'), ('id', '=', user.partner_id.id), ('id', 'in', user.partner_id.parent_id.ids)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
    </record>

     <record id="gym_member_rule_admin" model="ir.rule">
        <field name="name">Gym Member Access for admin</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="groups" eval="[Command.link(ref('group_gym_admin'))]"/>
         <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>



</odoo>
